---
import { getCollection, render } from 'astro:content';
import SiteLayout from '@/layouts/SiteLayout.astro';
import TrustBadgeStrip from '@/components/sections/TrustBadgeStrip.astro';
import { StickyQuoteCta } from '@/components/islands/StickyQuoteCta';
import { ProjectBriefDownload } from '@/components/islands/ProjectBriefDownload';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({ params: { slug: project.slug }, props: { project } }));
}

const { project } = Astro.props;
const { Content } = await render(project);
const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://chiengineer0.github.io/Website2026/' },
    { '@type': 'ListItem', position: 2, name: 'Projects', item: 'https://chiengineer0.github.io/Website2026/projects/' },
    { '@type': 'ListItem', position: 3, name: project.data.title, item: `https://chiengineer0.github.io/Website2026/projects/${project.slug}/` },
  ],
};
const reviewSchema = {
  '@context': 'https://schema.org',
  '@type': 'Review',
  reviewRating: { '@type': 'Rating', ratingValue: '5', bestRating: '5' },
  author: { '@type': 'Organization', name: 'ضمان الجودة - إصلاح الكهرباء' },
  itemReviewed: { '@type': 'Service', name: project.data.title },
  reviewBody: `This project in ${project.data.city} delivered code-compliant performance improvements and verified workmanship quality.`,
};
---
<SiteLayout title={`${project.data.title} | إصلاح الكهرباء`} description={project.data.scope}>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(reviewSchema)} />
  <article class="container-shell py-16">
    <nav class="text-xs text-white/55" aria-label="Breadcrumbs">
      <a href="/Website2026/" class="hover:text-white">Home</a> / <a href="/Website2026/projects/" class="hover:text-white">Projects</a> / <span class="text-white/80">{project.data.title}</span>
    </nav>
    <h1 class="section-title mt-4 font-black">{project.data.title}</h1>
    <p class="mt-3 text-white/80">{project.data.scope}</p>
    <div class="mt-6 grid gap-4 md:grid-cols-2">
      <img src={project.data.beforeImage} alt={`Before - ${project.data.coverAlt}`} class="rounded-lg border border-white/15" />
      <img src={project.data.afterImage} alt={`After - ${project.data.coverAlt}`} class="rounded-lg border border-white/15" />
    </div>
    <div class="surface-card mt-6 p-5">
      <ul class="grid gap-2 text-sm text-white/80 sm:grid-cols-3">
        <li><strong>Location:</strong><br />{project.data.city}</li>
        <li><strong>Duration:</strong><br />{project.data.duration}</li>
        <li><strong>Category:</strong><br />{project.data.category}</li>
      </ul>
      <div class="mt-4 flex flex-wrap gap-2">
        {project.data.tags.map((tag) => <span class="rounded-full border border-white/20 px-3 py-1 text-xs text-white/75">{tag}</span>)}
      </div>
    </div>
    <div class="prose prose-invert mt-8 max-w-none"><Content /></div>
    <div class="mt-8">
      <TrustBadgeStrip />
    </div>
    <div class="mt-8 flex flex-wrap gap-3">
      <a href="/Website2026/quote/" class="inline-flex min-h-12 items-center rounded-md bg-[var(--color-amber)] px-6 font-bold text-black">Discuss Similar Project</a>
      <ProjectBriefDownload client:visible title={project.data.title} city={project.data.city} scope={project.data.scope} duration={project.data.duration} tags={project.data.tags} />
      <a href="/Website2026/projects/" class="inline-flex min-h-12 items-center rounded-md border border-white/25 px-6">Back to Portfolio</a>
    </div>
    <StickyQuoteCta client:idle label="Start a Similar Project" />
  </article>
</SiteLayout>
