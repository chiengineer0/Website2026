---
import { getCollection } from 'astro:content';
import SiteLayout from '@/layouts/SiteLayout.astro';
import { ProjectLightbox } from '@/components/islands/ProjectLightbox';
import { BeforeAfterSlider } from '@/components/islands/BeforeAfterSlider';

const projects = await getCollection('projects');
const selectedCategory = Astro.url.searchParams.get('category');
const filtered = selectedCategory ? projects.filter((project) => project.data.category === selectedCategory) : projects;
---
<SiteLayout title="Project Portfolio | إصلاح الكهرباء" description="Explore completed residential and commercial electrical case studies.">
  <section class="container-shell py-16">
    <h1 class="section-title font-black">Project Portfolio</h1>
    <p class="mt-2 text-white/80">Verified installations with measurable reliability improvements and documented outcomes.</p>
    <div class="mt-6 columns-1 gap-4 md:columns-2 lg:columns-3">
      {filtered.map((project) => (
        <article class="surface-card mb-4 break-inside-avoid p-3">
          <BeforeAfterSlider
            client:idle
            beforeSrc={project.data.beforeImage}
            afterSrc={project.data.afterImage}
            beforeAlt={`Before - ${project.data.coverAlt}`}
            afterAlt={`After - ${project.data.coverAlt}`}
          />
          <h2 class="mt-3 font-semibold">{project.data.title}</h2>
          <p class="text-sm text-white/70">{project.data.city} · {project.data.scope}</p>
          <p class="mt-2 text-xs text-[var(--color-electric)]">Category: {project.data.category} · Duration: {project.data.duration}</p>
          <div class="mt-3 flex items-center justify-between">
            <a href={`/Website2026/projects/${project.slug}/`} class="text-sm text-[var(--color-electric)]">View case study</a>
            <ProjectLightbox client:idle images={[{ src: project.data.beforeImage, alt: `Before ${project.data.title}` }, { src: project.data.afterImage, alt: `After ${project.data.title}` }]} />
          </div>
        </article>
      ))}
    </div>
  </section>
</SiteLayout>
