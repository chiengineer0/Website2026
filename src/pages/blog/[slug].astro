---
import { getCollection, render } from 'astro:content';
import SiteLayout from '@/layouts/SiteLayout.astro';
import { formatReadTime } from '@/lib/utils';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post, allPosts: posts } }));
}

const { post, allPosts } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(post);
const related = allPosts.filter((entry: typeof post) => entry.id !== post.id).slice(0, 3);
const words = (remarkPluginFrontmatter?.words as number | undefined) ?? 500;
---
<SiteLayout title={`${post.data.title} | [BRAND NAME] Electric`} description={post.data.excerpt}>
  <article class="container-shell py-16">
    <a href="/Website2026/blog/" class="text-sm text-[var(--color-electric)]">← Back to blog</a>
    <h1 class="mt-4 text-4xl font-black">{post.data.title}</h1>
    <p class="mt-3 text-sm text-white/60">By {post.data.author} · {formatReadTime(words)}</p>
    <div class="prose prose-invert mt-8 max-w-none"><Content /></div>
  </article>
  <section class="container-shell pb-16">
    <h2 class="text-2xl font-bold">Related Posts</h2>
    <div class="mt-4 grid gap-4 md:grid-cols-3">
      {related.map((entry: typeof post) => (
        <a href={`/Website2026/blog/${entry.slug}/`} class="rounded-xl border border-white/15 bg-white/5 p-4">
          <h3 class="font-semibold">{entry.data.title}</h3>
          <p class="mt-2 text-sm text-white/70">{entry.data.excerpt}</p>
        </a>
      ))}
    </div>
  </section>
</SiteLayout>
