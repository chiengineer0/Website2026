---
import { getCollection, render } from 'astro:content';
import SiteLayout from '@/layouts/SiteLayout.astro';
import { formatReadTime } from '@/lib/utils';
import { StickyQuoteCta } from '@/components/islands/StickyQuoteCta';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post, allPosts: posts } }));
}

const { post, allPosts } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(post);
const related = allPosts.filter((entry: typeof post) => entry.id !== post.id).slice(0, 3);
const words = (remarkPluginFrontmatter?.words as number | undefined) ?? 500;
---
<SiteLayout title={`${post.data.title} | [BRAND NAME] Electric`} description={post.data.excerpt}>
  <article class="container-shell py-16">
    <nav class="text-xs text-white/55" aria-label="Breadcrumbs">
      <a href="/Website2026/" class="hover:text-white">Home</a> / <a href="/Website2026/blog/" class="hover:text-white">Blog</a> / <span class="text-white/80">Article</span>
    </nav>
    <h1 class="section-title mt-4 font-black">{post.data.title}</h1>
    <p class="mt-3 text-sm text-white/60">By {post.data.author} · {formatReadTime(words)} · {post.data.publishDate.toLocaleDateString()}</p>
    <div class="mt-4 flex flex-wrap gap-2">
      {post.data.tags.map((tag) => <span class="rounded-full border border-white/20 px-3 py-1 text-xs text-white/75">{tag}</span>)}
    </div>
    <div class="prose prose-invert mt-8 max-w-none"><Content /></div>
  </article>
  <section class="container-shell pb-16">
    <h2 class="text-2xl font-bold">Related Posts</h2>
    <div class="mt-4 grid gap-4 md:grid-cols-3">
      {related.map((entry: typeof post) => (
        <a href={`/Website2026/blog/${entry.slug}/`} class="surface-card p-4">
          <h3 class="font-semibold">{entry.data.title}</h3>
          <p class="mt-2 text-sm text-white/70">{entry.data.excerpt}</p>
        </a>
      ))}
    </div>
  </section>
  <StickyQuoteCta client:load label="Get a Professional Estimate" />
</SiteLayout>
